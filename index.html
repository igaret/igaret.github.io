<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DNS-over-HTTPS Query</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    .output { margin-top: 1em; padding: 1em; background: #f0f0f0; border-radius: 5px; }
    code { background: #e0e0e0; padding: 2px 4px; border-radius: 3px; }
  </style>
</head>
<body>
  <div class="output" id="output"></div>

  <script>
    async function parseAndQueryDNS() {
      const fragment = window.location.hash.substring(1);
      const params = new URLSearchParams(fragment);
      const output = document.getElementById('output');

      if (!params.has('dns-query')) {
        output.textContent = 'dns-query required.';
        return;
      }

      const domain = params.get('domain');
      const type = params.get('type') || 'A';
      const mimetype = params.get('mimetype') || 'json';
      const humanReadable = params.get('human-readable') === '1';

      if (!domain) {
        output.textContent = 'Missing domain parameter.';
        return;
      }

      const url = `https://dns.google/resolve?name=${encodeURIComponent(domain)}&type=${encodeURIComponent(type)}`;

      try {
        const res = await fetch(url, {
          headers: { 'Accept': mimetype === 'json' ? 'application/dns-json' : 'application/dns-message' }
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);

        if (humanReadable && data.Answer) {
          let result = `<b>domain:</b> ${domain}(${type}):`;
          for (const record of data.Answer) {
            result += `${record.data}<br>ttl: ${record.TTL}`;
          }
          result += '<br>';
          output.innerHTML = result;
        } else {
          output.innerHTML = `<strong>Raw JSON reply:${JSON.stringify(data, null, 2)}`;
        }
      } catch (err) {
        output.textContent = `error: ${err.message}`;
      }
    }

    window.addEventListener('load', parseAndQueryDNS);
    window.addEventListener('hashchange', parseAndQueryDNS);
  </script>
</body>
</html>