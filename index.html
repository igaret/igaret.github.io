<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>dns-query</title>
</head>
<body>
  <div id="output">Waiting for query...</div>

  <script>
    async function queryDNS(domain, type) {
      const url = "https://dns.google/resolve?name=" + encodeURIComponent(domain) + "&type=" + encodeURIComponent(type);
      const res = await fetch(url, {
        headers: { 'Accept': 'application/dns-json' }
      });
      if (!res.ok) throw new Error("HTTP " + res.status);
      return await res.json();
    }

    async function parseAndQueryDNS() {
      const params = new URLSearchParams(window.location.search);
      const output = document.getElementById("output");

      if (params.get("query") !== "dns-query") {
        output.textContent = "invalid query parameter.";
        return;
      }

      const domain = params.get("domain");
      if (!domain) {
        output.textContent = "missing domain parameter.";
        return;
      }

      const types = (params.get("type") || "A").split("+").map(t => t.trim().toUpperCase());
      const humanReadable = params.get("human-readable") === "1";
      const wildcard = params.get("wildcard") === "1";
      const subdomains = wildcard ? ["www", "mail", "mx", "api", "wiki", "doc", "ftp", "ww2", "blog", "account"] : [""];

      let result = "";
      result += "<b>" + domain + "</b><br>";
      result += "<i>types:</i> " + types.join(", ") + "<br>";
      result += "<i>wildcard:</i> " + (wildcard ? "enabled" : "disabled") + "<br><br>";

      for (const sub of subdomains) {
        const fqdn = sub ? sub + "." + domain : domain;
        result += "<b>" + fqdn + "</b><br>";
        for (const type of types) {
          try {
            const data = await queryDNS(fqdn, type);

            if (!data.Answer) {
              result += "<i>" + type + ":</i>  null<br>";
              continue;
            }

            if (humanReadable) {
              result += "<b>" + type + "</b><br>";
              for (const record of data.Answer) {
                result += "data: " + record.data + " <br>ttl: " + record.TTL + "s<br>";
              }
            } else {
              result += "<b>" + type + "raw: </b><br>";
              result += "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
            }
          } catch (err) {
            result += "<b>" + type + " error:</b> " + err.message + "<br>";
          }
        }
        result += "<br>";
      }

      output.innerHTML = result;
    }

    window.addEventListener("load", parseAndQueryDNS);
  </script>
</body>
</html>