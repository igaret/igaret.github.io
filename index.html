<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>DNS-over-HTTPS Query</title>
</head>
<body>
  <b><u><i>DNS-over-HTTPS Query Tool</i></u></b><br>
  This page parses <code>?query=</code> parameters and performs DNS queries using Google's DoH API.<br><br>
  <div id="output">Waiting for query...</div>

  <script>
    async function queryDNS(domain, type, mimetype) {
      const url = "https://dns.google/resolve?name=" + encodeURIComponent(domain) + "&type=" + encodeURIComponent(type);
      const res = await fetch(url, {
        headers: { 'Accept': mimetype === 'json' ? 'application/dns-json' : 'application/dns-message' }
      });
      if (!res.ok) throw new Error("HTTP " + res.status);
      return mimetype === 'json' ? await res.json() : await res.arrayBuffer();
    }

    async function parseAndQueryDNS() {
      const params = new URLSearchParams(window.location.search);
      const output = document.getElementById("output");

      if (params.get("query") !== "dns-query") {
        output.textContent = "Missing or invalid query parameter.";
        return;
      }

      const domain = params.get("domain");
      if (!domain) {
        output.textContent = "Missing domain parameter.";
        return;
      }

      const types = (params.get("type") || "A").split("+").map(t => t.trim().toUpperCase());
      const mimetype = params.get("mimetype") || "json";
      const humanReadable = params.get("human-readable") === "1";
      const wildcard = params.get("wildcard") === "1";
      const subdomains = wildcard ? ["www", "mail", "test", "foo", "bar"] : [""];

      let result = "";
      result += "<b>Querying DNS records for:</b> " + domain + "<br>";
      result += "<i>Types:</i> " + types.join(", ") + "<br>";
      result += "<i>Wildcard:</i> " + (wildcard ? "enabled" : "disabled") + "<br><br>";

      for (const sub of subdomains) {
        const fqdn = sub ? sub + "." + domain : domain;
        result += "<u>" + fqdn + "</u><br>";
        for (const type of types) {
          try {
            const data = await queryDNS(fqdn, type, mimetype);

            if (mimetype !== "json") {
              result += "<b>" + type + ":</b> Binary response received.<br>";
              continue;
            }

            if (humanReadable && data.Answer) {
              result += "<b>" + type + " Records:</b><br>";
</script>